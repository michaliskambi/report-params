# ----------------------------------------------------------------------------
# GitHub Actions workflow to build using FPC and package resulting binary.
# ----------------------------------------------------------------------------

name: Build

on: [push, pull_request]

defaults:
  run:
    shell: bash

jobs:
  build:
    name: Build
    strategy:
      matrix:
        runner: [windows-latest]
    runs-on: ${{ matrix.runner }}
    steps:
      - uses: actions/checkout@v4

      - name: which make
        run: which make

      - name: (Before FPC installed) make --version
        run: make --version
      - name: (Before FPC installed) mingw32-make --version
        run: mingw32-make --version
      - name: (Before FPC installed) /c/mingw64/bin/make --version
        run: /c/mingw64/bin/make --version

      - name: (Before FPC installed) Run make
        run: make
      - name: (Before FPC installed) Run mingw32-make
        run: mingw32-make
      - name: (Before FPC installed) Run /c/mingw64/bin/make
        run: /c/mingw64/bin/make

      - name: Install FPC+Lazarus
        uses: gcarreno/setup-lazarus@v3.2.17
        with:
          lazarus-version: stable

      - name: PATH
        run: echo $PATH
      - name: See environment
        run: ls -R /mingw64/bin
      - name: See environment 2
        run: ls -R /c/mingw64/bin

      - name: Run make
        run: make
      - name: Run mingw32-make
        run: mingw32-make
      - name: Run /c/mingw64/bin/make
        run: /c/mingw64/bin/make
